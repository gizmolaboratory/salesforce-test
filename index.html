<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salesforce Quiz</title>
    <style>
        /* ... ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìƒëµ (ì—¬ê¸°ì—” CSS ê·¸ëŒ€ë¡œ ìœ ì§€) ... */
    </style>
</head>
<body>
    <div class="container" id="app">ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>

    <script>
        let questions = []; // ì „ì—­ ë³€ìˆ˜
        let current = [];
        let round = 1, idx = 0, answers = {}, showing = false, done = false;

        async function loadQuestions() {
            try {
                const res = await fetch('https://raw.githubusercontent.com/gizmolaboratory/salesforce-test/refs/heads/main/questions.js');
                const text = await res.text();

                // âš ï¸ JavaScript ì‹¤í–‰ ì‹œ ì „ì—­ ë³€ê²½ì„ í—ˆìš©í•˜ë„ë¡ í•¨ìˆ˜ ìº¡ìŠí™”
                const exec = new Function('window', text);
                exec(window);

                if (!Array.isArray(window.questions) || window.questions.length === 0) {
                    throw new Error('questions.jsì— ì˜¬ë°”ë¥¸ questions ë°°ì—´ì´ ì—†ìŠµë‹ˆë‹¤.');
                }

                questions = window.questions;
                console.log(`âœ… ì´ ${questions.length}ê°œì˜ ë¬¸ì œê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                initQuiz();
            } catch (e) {
                console.error(e);
                document.getElementById('app').innerHTML = `
                    <div class="card">
                        <h2>ğŸš¨ ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</h2>
                        <pre>${e.message}</pre>
                    </div>`;
            }
        }

        function initQuiz() {
            getQuestions();
            render();
        }

        function getQuestions() {
            current = [...questions].sort(() => Math.random() - 0.5).slice(0, 60);
            idx = 0;
            answers = {};
            showing = false;
            done = false;
        }

        function toggle(i) {
            if (showing) return;
            const curr = answers[idx] || [];
            answers[idx] = curr.includes(i) ? curr.filter(x => x !== i) : [...curr, i];

            if (answers[idx].length === current[idx].ans.length) {
                showing = true;
            }
            render();
        }

        function submit() {
            showing = true;
            render();
        }

        function next() {
            if (idx < current.length - 1) {
                idx++;
                showing = false;
            } else {
                done = true;
            }
            render();
        }

        function nextRound() {
            round++;
            getQuestions();
            render();
        }

        function restart() {
            round = 1;
            getQuestions();
            render();
        }

        function render() {
            const app = document.getElementById('app');
            if (questions.length === 0) return;

            const q = current[idx];
            const sel = answers[idx] || [];
            const cor = q.ans;

            const correct = JSON.stringify(sel.slice().sort()) === JSON.stringify(cor.slice().sort());

            const count = Object.values(answers).filter((a, i) =>
                JSON.stringify((a || []).slice().sort()) ===
                JSON.stringify((current[i]?.ans || []).slice().sort())
            ).length;

            if (!done) {
                app.innerHTML = `
                    <div class="card">
                        <div class="stats">
                            <div class="stat">ğŸ¯ Round ${round}</div>
                            <div class="stat">ğŸ“Š Q${idx + 1}/60</div>
                            <div class="stat">âœ… ${count}/${Object.keys(answers).length}</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: ${((idx + 1) / 60) * 100}%"></div>
                        </div>
                        <div class="question">
                            <div class="q-text">${q.q}</div>
                        </div>
                        <div class="options">
                            ${q.opts.map((o, i) => {
                                let cl = 'option';
                                if (showing) {
                                    if (cor.includes(i)) cl += ' ok';
                                    else if (sel.includes(i)) cl += ' no';
                                } else if (sel.includes(i)) cl += ' sel';
                                return `<div class="${cl}" onclick="toggle(${i})">${o}</div>`;
                            }).join('')}
                        </div>
                        ${!showing && sel.length > 0 ? `<button class="btn" onclick="submit()">ë‹µë³€ ì œì¶œ</button>` : ''}
                        ${showing ? `
                            <div class="msg ${correct ? 'ok-msg' : 'no-msg'}">
                                ${correct ? 'âœ“ ì •ë‹µì…ë‹ˆë‹¤!' : `âœ— ì˜¤ë‹µì…ë‹ˆë‹¤ (ì •ë‹µ: ${cor.map(i => q.opts[i]).join(', ')})`}
                            </div>
                            <button class="btn" onclick="next()">${idx < 59 ? 'ë‹¤ìŒ' : 'ê²°ê³¼ ë³´ê¸°'}</button>
                        ` : ''}
                    </div>
                `;
            } else {
                const pct = Math.round((count / 60) * 100);
                app.innerHTML = `
                    <div class="card" style="text-align: center;">
                        <h2>ğŸ‰ ë¼ìš´ë“œ ${round} ì™„ë£Œ!</h2>
                        <div class="score">${pct}%</div>
                        <div style="font-size: 16px; color: #666; margin-bottom: 30px;">${count} / 60 ì •ë‹µ</div>
                        <button class="btn" onclick="nextRound()" style="margin-bottom: 10px;">ë‹¤ìŒ ë¼ìš´ë“œ</button>
                        <button class="btn" onclick="restart()">ì²˜ìŒë¶€í„°</button>
                    </div>
                `;
            }
        }

        loadQuestions();
    </script>
</body>
</html>
